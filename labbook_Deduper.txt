----------------------------------
LAB NOTEBOOK - Deduper
Author: Sophia Soriano
----------------------------------

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Part 1: 11OCT2022
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

* Created new github repository from Leslie's template:
    ** Repo: Deduper-ssoriano22
* Cloned repository to local Bi624 directory
    ** /Users/ssoriano/bioinfo/Bi624/Deduper-ssoriano22
* Created Deduper_Pseudo.txt for pseudocode assignment

12OCT2022

* Started interactive session on Talapas
    ** srun --account=bgmp --partition=bgmp --nodes=1 --ntasks-per-node=1 --time=8:00:00 --cpus-per-task=1 --pty bash
* Transferred test file from PS8 to Deduper folder
    ** Renamed test_PS8.sam
* Activated conda enviroment from PS8 w/ samtools
    ** conda activate bgmp_py310
* Used samtools to sort test_PS8.sam file
    ** samtools view -h Tests/test_PS8.sam > Tests/test_PS8.bam
    ** samtools sort Tests/test_PS8.bam > Tests/test_PS8_sorted.bam
    ** samtools view -h Tests/test_PS8_sorted.bam > Tests/test_PS8_sorted.sam
    ** @HQ header in new sorted file confirms sort by position column
    ** This file is going to be too complicated to make output files for...will use Leslie's test.sam file instead
* Wrote pseudo code - see Deduper_Pseudo.txt. Will submit for Part 1.
* Created test_short.sam from Leslie's test.sam file included in the github repo
    * test_short.sam contains tests for:
        ** Numerical and alphabetical RNAMEs
        ** 16-bit TRUE/FALSE (rev/for strand)
        ** Unknown UMI (AGCTACTT)
        ** Identical UMIs (AACGCCAT)
        ** Identical but reverse strand (lines 31+32)
        ** Duplicates (lines 33+34)
        ** Single-end soft-clipping and double-end soft-clipping (lines 28+29)
* Keep getting header errors when using samtools to try and sort test_short.sam or test.sam
    ** [E::sam_parse1] missing SAM header
        [W::sam_read1] Parse error at line 1
        samtools sort: truncated file. Aborting
    ** I wasn't using the -h option on the first samtools view command to transform sam -> bam

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Part 2: 16OCT2022
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

* Completed peer review through canvas

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Part 3: 25OCT2022
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

* Started soriano_deduper.py for real code
* Used git repo to transfer files created above to Talapas to work there
* Transferred get_args() from demux assignment (Demux.py)
    ** Adopted arguments for those defined in deduper assignment

26OCT2022

* Created soriano_Deduper.srun slurm script to test soriano_deduper.py w/ argparse options
* Wrote getRecord() and writeRecord() functions - see soriano_deduper.py
* Created known umi set from input file of known umis (STL96.txt)
* Reorganized main code and getRecord to identify and treat header lines differently from record lines
    ** Header lines need to always be printed to output file, record lines have to be assessed for duplicate characteristics
* Wrote getStrand() function to evaluate bitwise flag of current read for strandedness (forward or reverse)
* Need to reconsider what structure to use for tracking written reads...set? dict?
* Started coding processCIGAR() function.
    ** Used regex split w/ "\d+" to get list of letters in cigar and "[A-Z]+" to get list of numbers in cigar
    ** Needed to index-splice both lists to remove blanks (at beginning of letters list and end of number list)
    ** Coding scenarios for Ds, Ns, Ss in cigar...need to figure out how to find index of only last S in list

27OCT2022

* Completed processCIGAR() function - parses string differently pased on strandedness
* 